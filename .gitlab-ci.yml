stages:
    - build
    - test

build:
    stage: build
    tags: [ uft, windows ]
    script:
        - echo "Building.."
        - mkdir build
        - $ESCAPED_DIR = $CI_PROJECT_DIR.Replace('\', '\\')
        - echo $testsToRun
        - $TESTS_TO_RUN_XML = $testsToRun -replace ('\\?FTToolsLauncher\\', '')
        - Set-Content -Path ./build/testsToRun.mtbx -Value "$TESTS_TO_RUN_XML"
        - Set-Content -Path ./build/Props.txt -Value "runType=FileSystem"
        - Add-Content -Path ./build/Props.txt -Value "resultsFilename=build\\Results.xml"
        - Add-Content -Path ./build/Props.txt -Value "Test1=.\\build\\testsToRun.mtbx" # build\\testsToRun.mtbx
        - Add-Content -Path ./build/Props.txt -Value "resultUnifiedTestClassname=true"
        - Add-Content -Path ./build/Props.txt -Value "resultTestNameOnly=true"
        - Get-Content -Path ./build/Props.txt

    artifacts:
        paths:
            - build/
test:
    stage: test
    tags: [ uft, windows ]
    script:
        - echo "Testing"
        - echo $PWD
        - Test-Path "./build/Props.txt" -PathType leaf
        - Get-Content -Path ./build/Props.txt
        - $p = Start-Process -FilePath "./FTToolsLauncher_net48.exe" -ArgumentList "-paramfile $PWD/build/Props.txt" -NoNewWindow -PassThru
        - $p | Wait-Process
        - echo "Please check the [$PWD\build\Results.xml] file."

    artifacts:
        paths:
            - build/*.xml